function reduce(e,t,n){t.forEach(function(t){e=n(e,t)});return e}function makeArrayString(e){var t="[",n="";t=reduce(t,e,function(e,t){e=e+n+'"'+t+'"';n=", ";return e});t+="]";return t}function makeArguments(e){var t=e.split(",");t.forEach(function(e,n){t[n]=t[n].trim()});return t}function findAllOccurrences(e){var t=[],n;while(n=scope_function.exec(e)){if(n[1]){t.push({index:scope_function.lastIndex,args:makeArrayString(makeArguments(n[1])),insertLocation:findLocationToInsert(e,scope_function.lastIndex)})}}t.sort(function(e,t){return e.insertLocation<t.insertLocation?-1:1});return t}function findLocationToInsert(e,t){var n=t,r=e.length,i=["("];for(;n<r;n++){switch(e[n]){case"(":i.push("(");break;case")":i.pop();if(i.length==0){return n+1}break}}return-1}function insertStringAt(e,t,n){return t.substr(0,n)+e+t.substr(n)}function compile(e){var t=findAllOccurrences(e),n=0;t.forEach(function(t){e=insertStringAt("("+t.args+")",e,t.insertLocation+n);n+=t.args.length+2});return e}var scope_function=/scope\s*\([\w\d,"' ]*function\s*\(([\w\d_, ]*)\)/gm;compile.makeArrayString=makeArrayString;compile.findAllOccurrences=findAllOccurrences;compile.findLocationToInsert=findLocationToInsert;compile.insertStringAt=insertStringAt;module.exports=compile