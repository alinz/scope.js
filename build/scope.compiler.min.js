/**
 * scope compiler
 * version: 0.1.0
 * By Ali Najafizadeh
 * MIT Licensed.
 */

function reduce(e,t,n){t.forEach(function(t){e=n(e,t)});return e}function makeArrayString(e){var t="[",n="";t=reduce(t,e,function(e,t){e=e+n+'"'+t+'"';n=", ";return e});t+="]";return t}function makeArguments(e){var t=e.split(",");t.forEach(function(e,n){t[n]=t[n].trim()});return t}function findAllOccurrences(e){var t=[],n;while(n=scope_function.exec(e)){if(n[1]){t.push({index:scope_function.lastIndex,args:makeArrayString(makeArguments(n[1])),insertLocation:findLocationToInsert(e,scope_function.lastIndex)})}}t.sort(function(e,t){return e.insertLocation<t.insertLocation?-1:1});return t}function starComment(e,t){while(!(e[t]=="*"&&e[t+1]=="/")){t++}return t+1}function slashComment(e,t){while(t!=e.length&&e[t]!="\n"&&e[t]!="\r"){t++}return t}function passString(e,t,n){while(e[t]!=n){t++}return t}function ignoreCases(e,t){if(e[t]=="/"){switch(e[t+1]){case"*":t=starComment(e,t);break;case"/":t=slashComment(e,t);break}}else if(e[t]=='"'){t=passString(e,t+1,'"')}else if(e[t]=="'"){t=passString(e,t+1,"'")}return t}function findLocationToInsert(e,t){var n=t,r=e.length,i=["("];for(;n<r;n++){n=ignoreCases(e,n);switch(e[n]){case"(":i.push("(");break;case")":i.pop();if(i.length==0){return n+1}break}}return-1}function insertStringAt(e,t,n){return t.substr(0,n)+e+t.substr(n)}function compile(e){var t=findAllOccurrences(e),n=0;t.forEach(function(t){e=insertStringAt("("+t.args+")",e,t.insertLocation+n);n+=t.args.length+2});return e}var scope_function=/scope\s*\([\w\d,"' ]*function\s*\(([\w\d_, ]*)\)/gm;compile.makeArrayString=makeArrayString;compile.findAllOccurrences=findAllOccurrences;compile.findLocationToInsert=findLocationToInsert;compile.insertStringAt=insertStringAt;compile.starComment=starComment;compile.slashComment=slashComment;compile.passString=passString;compile.ignoreCases=ignoreCases;module.exports=compile